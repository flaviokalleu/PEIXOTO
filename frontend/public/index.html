<!DOCTYPE html>
<html lang="pt">

<head>
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@300;400&display=swap" />
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;700&display=swap" />
  <link rel="apple-touch-icon" href="%PUBLIC_URL%/apple-touch-icon.png" />
  <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
  <link rel="shortcut icon" href="%PUBLIC_URL%/favicon.ico">
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
  
  <!-- PWA Meta Tags -->
  <meta name="application-name" content="MetaBot" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="MetaBot" />
  <meta name="description" content="MetaBot - Plataforma Profissional de Atendimento Multicanal" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="msapplication-config" content="/browserconfig.xml" />
  <meta name="msapplication-TileColor" content="#0F172A" />
  <meta name="msapplication-tap-highlight" content="no" />
  
  <meta name="theme-color" content="#38BDF8" />
  <meta name="viewport" content="minimum-scale=1, initial-scale=1, width=device-width, shrink-to-fit=no, user-scalable=no, viewport-fit=cover" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }
    
    @keyframes dash {
      to {
        stroke-dashoffset: 0;
      }
    }
    
    .logo-path {
      stroke-dasharray: 300;
      stroke-dashoffset: 300;
      animation: dash 3s ease-in-out forwards;
    }
    
    .loading-text span {
      display: inline-block;
      animation: pulse 1.5s ease-in-out infinite;
      animation-delay: calc(0.1s * var(--i));
    }
    
    .progress-bar {
      height: 2px;
      width: 200px;
      background: rgba(255, 255, 255, 0.1);
      overflow: hidden;
      position: relative;
    }
    
    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #333 0%, #666 50%, #fff 100%);
      transition: width 0.3s ease;
    }
  </style>
  <script>
    if (!crossOriginIsolated) SharedArrayBuffer = ArrayBuffer;
  </script>
</head>

<body class="font-inter">
  <!-- Splash Screen Elegante -->
  <div id="splash-screen" class="fixed inset-0 flex flex-col items-center justify-center bg-black z-50">
    <div class="flex flex-col items-center text-center">
      <!-- Logo animado SVG -->
      <svg width="100" height="100" viewBox="0 0 100 100" class="mb-8">
        <circle cx="50" cy="50" r="40" stroke="#333" stroke-width="1" fill="transparent" />
        <path class="logo-path" d="M30,50 L45,65 L70,35" stroke="#fff" stroke-width="2" fill="transparent" />
      </svg>
      
      <!-- Nome do sistema com efeito fade -->
      <h1 class="text-3xl font-semibold text-white mb-10 font-jakarta opacity-90">
        MetaBot
      </h1>
      
      <!-- Barra de progresso estilizada -->
      <div class="progress-bar rounded mb-8">
        <div id="progress-bar" class="progress-fill"></div>
      </div>
      
      <!-- Texto de carregamento animado -->
      <div class="loading-text text-gray-400 text-sm tracking-widest uppercase">
        <span style="--i:1">C</span>
        <span style="--i:2">A</span>
        <span style="--i:3">R</span>
        <span style="--i:4">R</span>
        <span style="--i:5">E</span>
        <span style="--i:6">G</span>
        <span style="--i:7">A</span>
        <span style="--i:8">N</span>
        <span style="--i:9">D</span>
        <span style="--i:10">O</span>
      </div>
    </div>
  </div>

  <!-- Interface Principal (mantida do c√≥digo original) -->
  <div id="root" class="hidden min-h-screen bg-gray-100">
    <header class="bg-black text-white p-4 shadow-md">
      <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-2xl font-bold font-jakarta">
          MetaBot
        </h1>
        <nav>
          <ul class="flex space-x-6">
            <li><a href="#" class="hover:text-gray-300 transition">In√≠cio</a></li>
            <li><a href="#" class="hover:text-gray-300 transition">Dashboard</a></li>
            <li><a href="#" class="hover:text-gray-300 transition">Configura√ß√µes</a></li>
            <li><a href="#" class="hover:text-gray-300 transition">Sair</a></li>
          </ul>
        </nav>
      </div>
    </header>
    <main class="container mx-auto p-6">
      <section class="bg-white rounded-lg shadow p-6">
        <h2 class="text-xl font-semibold mb-4">Bem-vindo ao MetaBot</h2>
        <p class="text-gray-600">
          Esta √© a interface principal do sistema MetaBot. Aqui voc√™ pode acessar dashboards, gerenciar configura√ß√µes e muito mais.
          Este √© um modelo inicial que pode ser personalizado conforme suas necessidades.
        </p>
      </section>
    </main>
  </div>

  <noscript>
    <div class="text-center p-4 text-red-600">
      Voc√™ precisa habilitar o JavaScript para executar este aplicativo.
    </div>
  </noscript>

  <script>
    // L√≥gica da barra de progresso aprimorada
    let progress = 0;
    const progressBar = document.getElementById('progress-bar');
    const splashScreen = document.getElementById('splash-screen');
    const root = document.getElementById('root');

    const updateProgress = setInterval(() => {
      if (progress < 50) {
        progress += 5; // Mais r√°pido no in√≠cio
      } else if (progress < 85) {
        progress += 2; // Velocidade m√©dia no meio
      } else if (progress < 99) {
        progress += 0.5; // Desacelera no final
      }
      
      progressBar.style.width = `${progress}%`;

      if (progress >= 100) {
        clearInterval(updateProgress);
        
        // Fade out da splash screen
        setTimeout(() => {
          splashScreen.style.opacity = '0';
          splashScreen.style.transition = 'opacity 0.8s ease';
          
          setTimeout(() => {
            splashScreen.classList.add('hidden');
            root.classList.remove('hidden');
            // Adiciona um fade in suave para a interface principal
            root.style.opacity = '0';
            root.style.transition = 'opacity 0.5s ease';
            setTimeout(() => { root.style.opacity = '1'; }, 50);
          }, 800);
        }, 300);
      }
    }, 100);

    // Fun√ß√£o para for√ßar o t√©rmino do progresso
    window.finishProgress = () => {
      progress = 100;
      progressBar.style.width = '100%';
      clearInterval(updateProgress);
      
      setTimeout(() => {
        splashScreen.style.opacity = '0';
        splashScreen.style.transition = 'opacity 0.8s ease';
        
        setTimeout(() => {
          splashScreen.classList.add('hidden');
          root.classList.remove('hidden');
          // Adiciona um fade in suave para a interface principal
          root.style.opacity = '0';
          root.style.transition = 'opacity 0.5s ease';
          setTimeout(() => { root.style.opacity = '1'; }, 50);
        }, 800);
      }, 300);
    };

    // Registrar Service Worker para PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then((registration) => {
            console.log('SW registered: ', registration);
            
            // Listener para quando uma nova vers√£o do SW estiver dispon√≠vel
            registration.addEventListener('updatefound', () => {
              const newWorker = registration.installing;
              newWorker.addEventListener('statechange', () => {
                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                  // Nova vers√£o dispon√≠vel, recarregar ap√≥s 3 segundos
                  console.log('Nova vers√£o do PWA dispon√≠vel, recarregando...');
                  setTimeout(() => {
                    window.location.reload();
                  }, 3000);
                }
              });
            });
          })
          .catch((registrationError) => {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }

    // PWA Install Prompt
    let deferredPrompt;
    let installButton = null;

    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('PWA: beforeinstallprompt event triggered');
      // Prevent Chrome 67 and earlier from automatically showing the prompt
      e.preventDefault();
      // Stash the event so it can be triggered later
      deferredPrompt = e;
      
      // Create install button
      createInstallButton();
    });

    function createInstallButton() {
      if (installButton) return; // Button already exists
      
      installButton = document.createElement('button');
      installButton.innerHTML = 'üì± Instalar App';
      installButton.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 9999;
        background: #38BDF8;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(56, 189, 248, 0.3);
        transition: all 0.3s ease;
        font-family: Inter, sans-serif;
      `;
      
      installButton.addEventListener('mouseenter', () => {
        installButton.style.transform = 'scale(1.05)';
        installButton.style.boxShadow = '0 6px 16px rgba(56, 189, 248, 0.4)';
      });
      
      installButton.addEventListener('mouseleave', () => {
        installButton.style.transform = 'scale(1)';
        installButton.style.boxShadow = '0 4px 12px rgba(56, 189, 248, 0.3)';
      });
      
      installButton.addEventListener('click', async () => {
        if (deferredPrompt) {
          // Show the install prompt
          deferredPrompt.prompt();
          // Wait for the user to respond to the prompt
          const { outcome } = await deferredPrompt.userChoice;
          console.log(`PWA install outcome: ${outcome}`);
          // Clear the deferred prompt
          deferredPrompt = null;
          // Remove install button
          if (installButton) {
            installButton.remove();
            installButton = null;
          }
        }
      });
      
      document.body.appendChild(installButton);
      
      // Auto-hide after 10 seconds if not clicked
      setTimeout(() => {
        if (installButton) {
          installButton.style.opacity = '0.6';
          setTimeout(() => {
            if (installButton) {
              installButton.remove();
              installButton = null;
            }
          }, 2000);
        }
      }, 10000);
    }

    // Listen for app installed event
    window.addEventListener('appinstalled', () => {
      console.log('PWA: App installed successfully');
      if (installButton) {
        installButton.remove();
        installButton = null;
      }
      deferredPrompt = null;
    });

    // Check if running as installed PWA
    if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
      console.log('PWA: Running as installed app');
      document.documentElement.classList.add('pwa-installed');
    }

    // Register Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        console.log('Attempting to register service worker...');
        
        navigator.serviceWorker.register('/service-worker.js', { 
          scope: '/',
          updateViaCache: 'none'
        })
          .then(function(registration) {
            console.log('SW registered successfully: ', registration);
            console.log('SW scope: ', registration.scope);
            
            registration.addEventListener('updatefound', () => {
              console.log('SW update found');
            });
          })
          .catch(function(registrationError) {
            console.error('SW registration failed: ', registrationError);
          });
          
        // Check for existing service worker
        navigator.serviceWorker.ready.then(registration => {
          console.log('SW ready: ', registration);
        });
      });
    } else {
      console.log('Service Worker not supported');
    }
  </script>
</body>
</html>